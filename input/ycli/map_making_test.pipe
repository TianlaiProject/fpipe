# -*- mode: python3; -*-
#
from fpipe.map import dirtymap_hp, cleanmap
#from fpipe.timestream.data_base import DATA_BASE as DB
import os
import numpy as np

data_base = '/home/ycli/fanalysis/sim/'

pipe_tasks = []
pipe_outdir = data_base
pipe_logging = 'info' #'debug' #'info'
pipe_copy = False
pipe_feedback = 0
pipe_timing = True

mock=0
#file_temp = '/sim_mock%03d/MeerKAT6_RealOBS_ideal_withbeam_%s.h5'
f_list = ['20190224194828', '20190225004011', '20190330171902', '20190401220617',
          '20190423204156', '20190424203957', '20190711150953',]
input_files = ['/sim_mock%03d/MeerKAT6_RealOBS_ideal_withbeam_%s.h5'%(mock, f) for f in f_list]

suffix = '_mock%03d'

pipe_tasks.append(dirtymap_hp.DirtyMap_healpix)
pipe_tasks.append(cleanmap.CleanMap)

dmh_input_files  = ['/home/ycli/fanalysis/sim/tod/%s'%f for f in input_files]
dmh_output_files = ['map/dm_MeerKAT6_RealOBS%s'%suffix,]
dmh_nside = 256
dmh_feed_select = (0, None)
dmh_ra_range = [145, 180]
dmh_dec_range = [-2, 8]
dmh_freq_select = (100, 102)
dmh_diag_cov = True
dmh_deweight_time_slope = True
dmh_deweight_time_mean  = True
dmh_tblock_len = 1800
dmh_center_only = True
dmh_beam_fwhm_at21cm = 1.06

cm_input_files  = ['map/dm_MeerKAT6_RealOBS%s_vis.h5'%suffix, ]
cm_output_files = ['map/cm_MeerKAT6_RealOBS%s_vis.h5'%suffix, ]
cm_healpix  = True
cm_diag_cov = True
cm_threshold = 1.e-2
